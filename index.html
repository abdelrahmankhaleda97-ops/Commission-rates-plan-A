<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Commission Finder â€” Plan A (Old Design + AAS Nawy Split)</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--accent:#22c55e;--warn:#f59e0b;--chip:#1f2937}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a 40%,#0b1220);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text)}
    header{position:sticky;top:0;background:rgba(15,23,42,.9);backdrop-filter:blur(8px);border-bottom:1px solid #1f2937}
    .wrap{max-width:1150px;margin:0 auto;padding:14px 16px}
    .brand{display:flex;align-items:center;gap:14px}
    .brand svg{height:56px;width:56px}
    h1{margin:0;font-size:22px;font-weight:800;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;margin-top:2px}
    .controls{display:grid;grid-template-columns:1fr 200px 120px 160px;gap:10px;margin-top:12px}
    input,select,button{height:40px;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:var(--text);padding:0 12px;font-size:14px}
    button{background:#1f2937;cursor:pointer}
    button.primary{background:#16a34a;border-color:#15803d}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px;margin:16px auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left;font-size:14px;vertical-align:top}
    th{font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
    tbody tr:hover{background:#0b1220}
    .hi{background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.45)}
    .note{display:inline-block;background:#1f2937;border:1px dashed #334155;border-radius:8px;padding:6px 8px;font-size:12px;color:#eab308}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#0b1220;border:1px solid #1f2937;color:var(--muted);font-size:12px}
    .win{color:#16a34a}
    .kpi{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .pill{background:#0b1220;border:1px solid #1f2937;border-radius:999px;padding:6px 10px;font-size:12px;color:#muted}
    @media (max-width:800px){
      .controls{grid-template-columns:1fr 1fr;gap:8px}
      .controls .export{grid-column:1 / -1}
      th:nth-child(2),td:nth-child(2),th:nth-child(4),td:nth-child(4),th:nth-child(6),td:nth-child(6){display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <!-- Plan A black & white logo -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" aria-label="Plan A logo">
          <circle cx="50" cy="50" r="48" fill="#fff" stroke="#000" stroke-width="4" />
          <path d="M30 75 L50 20 L70 75 L60 75 L55 62 H45 L40 75 Z" fill="#000" />
          <text x="50" y="90" font-size="16" text-anchor="middle" fill="#000" font-weight="bold">Plan A</text>
        </svg>
        <div>
          <h1>Commission Finder</h1>

          <div class="sub">Nawy split for Al Ahly Sabbour: Youd 4.00% & All other projects 3.50%.</div>
        </div>
      </div>
      <div class="controls">
        <input id="search" placeholder="Type developer name..." />
        <select id="devList"><option value="">All developers</option></select>
        <button id="go" class="primary">Search</button>
        <button id="export" class="export">Export results (CSV)</button>
      </div>
      <div class="kpi" id="kpis"></div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <table id="tbl">
        <thead>
          <tr>
            <th>Developer</th>
            <th>Coldwell Project</th>
            <th>Coldwell %</th>
            <th>Nawy Project</th>
            <th>Nawy %</th>
            <th>RED Project</th>
            <th>RED %</th>
            <th>Best</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const DATA = [{"developer": "Ajna", "project_coldwell": "All Projects", "coldwell_raw": 0.033, "project_nawy": "All Projects", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Akam", "project_coldwell": "Scenario - Scene 7", "coldwell_raw": 0.038, "project_nawy": "Scenario - Scene 7", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Akam Al Rajhi", "project_coldwell": "Dose", "coldwell_raw": 0.038, "project_nawy": "Dose", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Ahly Sabbour", "project_coldwell": "All Projects", "coldwell_raw": 0.04, "project_nawy": "Youd", "nawy_raw": 4.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Ahly Sabbour", "project_coldwell": "All Projects", "coldwell_raw": 0.04, "project_nawy": "All other projects", "nawy_raw": 3.5, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Marasem", "project_coldwell": "Mar Ville & Mar Bay", "coldwell_raw": 0.043, "project_nawy": "Mar Ville & Mar Bay", "nawy_raw": 0.04, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Marasem", "project_coldwell": "Other projects", "coldwell_raw": 0.028, "project_nawy": "Other projects", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Qamzi", "project_coldwell": "Seazen", "coldwell_raw": 0.038, "project_nawy": "Seazen", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Al Qamzi", "project_coldwell": "East Shire", "coldwell_raw": 0.028, "project_nawy": "East Shire", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Arabella", "project_coldwell": "All Projects", "coldwell_raw": 0.028, "project_nawy": "All Projects", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Arabia Holding", "project_coldwell": "All Projects", "coldwell_raw": 0.033, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "City Edge", "project_coldwell": "Other projects", "coldwell_raw": 0.023, "project_nawy": "Other projects", "nawy_raw": 0.0225, "project_red": "", "red_raw": null, "note": ""}, {"developer": "City Edge", "project_coldwell": "Down Town - Latin City - Down Town Commercial", "coldwell_raw": 0.018, "project_nawy": "Down Town - Latin City - Down Town Commercial", "nawy_raw": 0.0175, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Cred", "project_coldwell": "Castle Landmark", "coldwell_raw": 0.048, "project_nawy": "Castle Landmark", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Cred", "project_coldwell": "Ever West", "coldwell_raw": 0.038, "project_nawy": "Ever West", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Cred", "project_coldwell": "Ever East", "coldwell_raw": 0.038, "project_nawy": "Ever East", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Dorra", "project_coldwell": "Address East", "coldwell_raw": 0.038, "project_nawy": "Address East", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Dorra", "project_coldwell": "The Village West", "coldwell_raw": 0.028, "project_nawy": "The Village West", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Equity", "project_coldwell": "The Capital Way", "coldwell_raw": 0.038, "project_nawy": "The Capital Way", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Equity", "project_coldwell": "Water Way North Coast - Water Way New Cairo - The View - Kairo - W Signature", "coldwell_raw": 0.028, "project_nawy": "Water Way North Coast - Water Way New Cairo - The View - Kairo - W Signature", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Equity", "project_coldwell": "Traingle - W55", "coldwell_raw": 0.028, "project_nawy": "Traingle - W55", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Equity", "project_coldwell": "WBR1", "coldwell_raw": 0.018, "project_nawy": "WBR1", "nawy_raw": 0.0175, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Equity", "project_coldwell": "White - Water Way Villas - 5A - The Hub", "coldwell_raw": 0.012, "project_nawy": "White - Water Way Villas - 5A - The Hub", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Hassan Allam", "project_coldwell": "Swan Lake Residence - Swan lake El Gouna -Swan Lake west", "coldwell_raw": 0.023, "project_nawy": "All Projects", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": "FLAT RATE"}, {"developer": "Hassan Allam", "project_coldwell": "The Valleys - Park central - Hap Town", "coldwell_raw": 0.033, "project_nawy": "", "nawy_raw": null, "project_red": "", "red_raw": null, "note": ""}, {"developer": "HDP", "project_coldwell": "All Projects", "coldwell_raw": 0.033, "project_nawy": "All Projects", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "HDP", "project_coldwell": "West Views Residence - The Island", "coldwell_raw": 0.028, "project_nawy": "West Views Residence - The Island", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Horizon Egypt Developments", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Hyde Park", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Il Cazar", "project_coldwell": "The C", "coldwell_raw": 0.038, "project_nawy": "Stoda", "nawy_raw": 0.0075, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Il Cazar", "project_coldwell": "Creek District  - Stoda", "coldwell_raw": 0.018, "project_nawy": "Creek District  - Creektown", "nawy_raw": 1.75, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Il Cazar", "project_coldwell": "Westdays-Glen-Safia - The Crest -Go Heliopolis", "coldwell_raw": 0.038, "project_nawy": "Westdays-Glen-Safia - The Crest -Go Heliopolis", "nawy_raw": 4.25, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Inertia", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Juzur", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "La Vista", "project_coldwell": "All Projects", "coldwell_raw": 0.03, "project_nawy": "All Projects", "nawy_raw": 0.03, "project_red": "", "red_raw": null, "note": ""}, {"developer": "LMD", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Mabany Idris", "project_coldwell": "All Projects ", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Madaar", "project_coldwell": "Azha North - Azha Sokhna", "coldwell_raw": 0.033, "project_nawy": "Azha North - Azha Sokhna", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Marakez", "project_coldwell": "All Projects", "coldwell_raw": 0.033, "project_nawy": "All Projects", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Marsa Baghosh", "project_coldwell": "Marsa Baghoush", "coldwell_raw": 0.033, "project_nawy": "Marsa Baghoush", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Maven", "project_coldwell": "All Projects", "coldwell_raw": 0.042, "project_nawy": "All Projects", "nawy_raw": 0.045, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Memaar El Morshedy", "project_coldwell": "All Projects except Degla Palms", "coldwell_raw": 0.048, "project_nawy": "All Projects except Degla Palms", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Memaar El Morshedy", "project_coldwell": "Degla Palms", "coldwell_raw": 0.028, "project_nawy": "Degla Palms", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Mercon", "project_coldwell": "Riverton", "coldwell_raw": 3.75, "project_nawy": "Riverton", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": "Coldwell: For Apartments"}, {"developer": "Mercon", "project_coldwell": "Riverton", "coldwell_raw": 2.75, "project_nawy": "Riverton", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": "Coldwell: For Town Houses"}, {"developer": "Mercon", "project_coldwell": "Nurai", "coldwell_raw": 0.033, "project_nawy": "Nurai", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Mercon", "project_coldwell": "G7 Mall", "coldwell_raw": 0.033, "project_nawy": "G7 Mall", "nawy_raw": 3.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Misr Italia", "project_coldwell": "Il Bosco-Vinici Res - Vinici Street - Il Bosco City- Solare - Radical 1 - Cairo Business Park", "coldwell_raw": 0.042, "project_nawy": "Il Bosco-Vinici Res - Vinici Street - Il Bosco City- Solare - Radical 1 - Cairo Business Park", "nawy_raw": 4.25, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Misr Italia", "project_coldwell": "Kai Al Sokhna", "coldwell_raw": 0.028, "project_nawy": "Kai Al Sokhna", "nawy_raw": 2.25, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Misr Italia", "project_coldwell": "Cairo Business Park-Buildings", "coldwell_raw": 0.023, "project_nawy": "Cairo Business Park-Buildings", "nawy_raw": 2.25, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Modon", "project_coldwell": "All Projects except Boutique Valley 2", "coldwell_raw": 0.028, "project_nawy": "All Projects except Boutique Valley 2", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Modon", "project_coldwell": "Boutique Valley 2", "coldwell_raw": 0.023, "project_nawy": "Boutique Valley 2", "nawy_raw": 0.0225, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Modon", "project_coldwell": "Lagoons", "coldwell_raw": 0.038, "project_nawy": "Lagoons", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Modon AD", "project_coldwell": "Modon Ras El Hekma", "coldwell_raw": 0.02, "project_nawy": "Modon Ras El Hekma", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Mountain View", "project_coldwell": "Grand Valleys & Jirian", "coldwell_raw": 0.04, "project_nawy": "Grand Valleys & Jirian", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Mountain View", "project_coldwell": "All Projects Except Grand Valleys & Jirian", "coldwell_raw": 0.04, "project_nawy": "All Projects Except Grand Valleys & Jirian", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Naia Developments", "project_coldwell": "All projects", "coldwell_raw": 0.038, "project_nawy": "All projects", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Nations Of Sky", "project_coldwell": "Zomra", "coldwell_raw": 0.03, "project_nawy": "Zomra", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "ORA", "project_coldwell": "Zed West - Zed East- Solana West - Solana East", "coldwell_raw": 0.028, "project_nawy": "Zed West - Zed East- Solana West - Solana East", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "ORA", "project_coldwell": "Silver Sands", "coldwell_raw": 4.75, "project_nawy": "Silver Sands", "nawy_raw": 4.75, "project_red": "", "red_raw": null, "note": "Coldwell: (During August Only) | Nawy: (During August Only)"}, {"developer": "ORA Dubai", "project_coldwell": "Bayn", "coldwell_raw": 0.048, "project_nawy": "Bayn", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Orascom Gouna", "project_coldwell": "All Projects", "coldwell_raw": 0.028, "project_nawy": "All Projects", "nawy_raw": 0.028, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Orascom Makadi", "project_coldwell": "Makadi Heights", "coldwell_raw": 0.038, "project_nawy": "Makadi Heights", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Orascom O West", "project_coldwell": "O West", "coldwell_raw": 0.04, "project_nawy": "O West", "nawy_raw": 0.04, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Palm Hills", "project_coldwell": "Jirian", "coldwell_raw": 0.038, "project_nawy": "Jirian", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": "FLAT RATE"}, {"developer": "Palm Hills", "project_coldwell": "All Projects Except Jirian", "coldwell_raw": 0.028, "project_nawy": "All Projects Except Jirian", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "People And Places", "project_coldwell": "All Projects", "coldwell_raw": 0.033, "project_nawy": "All Projects", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Pre", "project_coldwell": "All Projects Except Point 90 Extension & ZAG", "coldwell_raw": 0.042, "project_nawy": "All Projects Except Point 90 Extension & ZAG", "nawy_raw": 0.04, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Pre", "project_coldwell": "Point 90 Extension & ZAG", "coldwell_raw": 0.028, "project_nawy": "Point 90 Extension & ZAG", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Qatari Diar", "project_coldwell": "City Gate", "coldwell_raw": 0.023, "project_nawy": "City Gate", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Rocc - Redcon", "project_coldwell": "Golden Gate - Admin", "coldwell_raw": 0.033, "project_nawy": "Golden Gate - Admin", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Rocc - Redcon", "project_coldwell": "Golden Gate - Commercial", "coldwell_raw": 0.038, "project_nawy": "Golden Gate - Commercial", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Rocc - Redcon", "project_coldwell": "Golden Gate - Bulding", "coldwell_raw": 0.023, "project_nawy": "Golden Gate - Bulding", "nawy_raw": 0.023, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Roya", "project_coldwell": "The big business district", "coldwell_raw": 0.033, "project_nawy": "All projects", "nawy_raw": 3.5, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Roya", "project_coldwell": "The Hills, Telal Soul And Telal Sokhna", "coldwell_raw": 0.028, "project_nawy": "", "nawy_raw": null, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Roya", "project_coldwell": "Telal East", "coldwell_raw": 0.028, "project_nawy": "", "nawy_raw": null, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Royal Developments", "project_coldwell": "Monark Residence", "coldwell_raw": 0.038, "project_nawy": "Monark Residence", "nawy_raw": 0.0425, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SED", "project_coldwell": "Marina 8 By The Lake - Latin District", "coldwell_raw": 2.75, "project_nawy": "Marina 8 By The Lake - Latin District", "nawy_raw": 1.75, "project_red": "", "red_raw": null, "note": "Coldwell: (From 10-Aug To 06-Sep )"}, {"developer": "SED", "project_coldwell": "Blu Vert", "coldwell_raw": 0.068, "project_nawy": "Blu Vert", "nawy_raw": 0.0675, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SED", "project_coldwell": "Central", "coldwell_raw": 0.038, "project_nawy": "Central", "nawy_raw": 0.0375, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SED", "project_coldwell": "Sawari - Arabesque - Fostat - Marina 8", "coldwell_raw": 0.018, "project_nawy": "Sawari - Arabesque - Fostat - Marina 8", "nawy_raw": 0.0175, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SED", "project_coldwell": "Nile Towers", "coldwell_raw": 0.028, "project_nawy": "Nile Towers", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SED", "project_coldwell": "Jayd", "coldwell_raw": 0.023, "project_nawy": "Jayd", "nawy_raw": 0.0225, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Serac Developments", "project_coldwell": "Shamasi", "coldwell_raw": 0.033, "project_nawy": "Shamasi", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Serac Developments", "project_coldwell": "New Cairo projects except City Hall Ninety", "coldwell_raw": 0.028, "project_nawy": "New Cairo projects except City Hall Ninety", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Serac Developments", "project_coldwell": "City Hall New Capital", "coldwell_raw": 0.038, "project_nawy": "City Hall New Capital", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Serac Developments", "project_coldwell": "Alura", "coldwell_raw": 0.023, "project_nawy": "Alura", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Serac Developments", "project_coldwell": "City Hall Nintey", "coldwell_raw": 0.033, "project_nawy": "City Hall Nintey", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Sky AD", "project_coldwell": "Sky North", "coldwell_raw": 0.048, "project_nawy": "Sky North", "nawy_raw": 0.045, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Sky AD", "project_coldwell": "All Projects except Capital Avenue & Sky North", "coldwell_raw": 0.048, "project_nawy": "All Projects except Capital Avenue & Sky North", "nawy_raw": 0.0325, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Sky AD", "project_coldwell": "Capital Avenue", "coldwell_raw": 0.048, "project_nawy": "Capital Avenue", "nawy_raw": 0.035, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Sodic", "project_coldwell": "All Projects Except Sodic East", "coldwell_raw": 3.75, "project_nawy": "All Projects Except Sodic East", "nawy_raw": 3.75, "project_red": "", "red_raw": null, "note": "Coldwell: (From 14/8 To 15/9) | Nawy: (From 14/8 To 15/9)"}, {"developer": "Sodic", "project_coldwell": "Sodic East", "coldwell_raw": 3.75, "project_nawy": "Sodic East", "nawy_raw": 3.75, "project_red": "", "red_raw": null, "note": "Coldwell: (From 14/8 To 15/9) | Nawy: (From 14/8 To 15/9)"}, {"developer": "Soma Bay", "project_coldwell": "All Projects", "coldwell_raw": 2.75, "project_nawy": "All Projects", "nawy_raw": 0.0275, "project_red": "", "red_raw": null, "note": "Coldwell: For units Up To 10 M - 3.25% For units more than 10 M To 20 M - 3.75% For units more than 20 M Up To 30 M - 4.25% For units more than 30 M"}, {"developer": "SUD El Safwa", "project_coldwell": "El Obour Projects", "coldwell_raw": 0.033, "project_nawy": "El Obour Projects", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SUD El Safwa", "project_coldwell": "New Capital Projects", "coldwell_raw": 0.042, "project_nawy": "New Capital Projects", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SUD El Safwa", "project_coldwell": "Mansoura Projects", "coldwell_raw": 0.023, "project_nawy": "Mansoura Projects", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "SUD El Safwa", "project_coldwell": "New Cairo Projects", "coldwell_raw": 0.028, "project_nawy": "New Cairo Projects", "nawy_raw": 0.0, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Tameer - Azzad", "project_coldwell": "All Projects", "coldwell_raw": 0.032, "project_nawy": "All Projects", "nawy_raw": 3.17, "project_red": "", "red_raw": null, "note": ""}, {"developer": "Tameer - Azzad", "project_coldwell": "UBL", "coldwell_raw": 4.75, "project_nawy": "UBL", "nawy_raw": 3.17, "project_red": "", "red_raw": null, "note": "Coldwell: (Till 30 September 2025)"}, {"developer": "Tatweer Misr", "project_coldwell": "All Projects", "coldwell_raw": 0.038, "project_nawy": "All Projects", "nawy_raw": 3.5, "project_red": "", "red_raw": null, "note": ""}, {"developer": "The Ark Developments", "project_coldwell": "The Ark -Rafts Of Ark", "coldwell_raw": 0.028, "project_nawy": "The Ark -Rafts Of Ark", "nawy_raw": 2.75, "project_red": "", "red_raw": null, "note": ""}];

    function normToPctNumber(v){
      if(v==null || v==='') return null;
      const n = Number(v);
      if(Number.isNaN(n)) return null;
      if(n === 0) return 0;
      if(n <= 1) return n*100;
      if(n > 100) return n/100;
      return n;
    }
    const fmtPct = (v)=> v==null? '' : normToPctNumber(v).toFixed(2) + '%';

    function bestOf(r){
      const cand = [
        ['Coldwell', normToPctNumber(r.coldwell_raw)],
        ['Nawy', normToPctNumber(r.nawy_raw)],
        ['RED', normToPctNumber(r.red_raw)],
      ].filter(([,v])=> v!=null && v>0);
      if(!cand.length) return null;
      cand.sort((a,b)=> b[1]-a[1]);
      if(cand.length>1 && cand[0][1]===cand[1][1]) return null; // tie
      return cand[0];
    }

    function render(rows){
      const tbody = document.querySelector('#tbl tbody');
      tbody.innerHTML='';

      rows.forEach(r=>{
        const best = bestOf(r);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.developer||''}</td>
          <td>${r.project_coldwell||''}</td>
          <td class="${best&&best[0]==='Coldwell'?'hi':''}">${fmtPct(r.coldwell_raw)}</td>
          <td>${r.project_nawy||''}</td>
          <td class="${best&&best[0]==='Nawy'?'hi':''}">${fmtPct(r.nawy_raw)}</td>
          <td>${r.project_red||''}</td>
          <td class="${best&&best[0]==='RED'?'hi':''}">${fmtPct(r.red_raw)}</td>
          <td>${best? `<span class="badge win">${best[0]}: ${best[1].toFixed(2)}%</span>` : ''}</td>
          <td>${r.note ? `<span class="note">${r.note}</span>` : ''}</td>
        `;
        tbody.appendChild(tr);
      });

      const k = document.getElementById('kpis');
      const total = rows.length;
      const wins = rows.reduce((acc,r)=>{ const b=bestOf(r); if(!b) return acc; acc[b[0]]=(acc[b[0]]||0)+1; return acc; },{});
      k.innerHTML = `
        <div class="pill">Rows: ${total}</div>
        <div class="pill">Coldwell wins: ${wins.Coldwell||0}</div>
        <div class="pill">Nawy wins: ${wins.Nawy||0}</div>
        <div class="pill">RED wins: ${wins.RED||0}</div>`;
    }

    function toCSV(rows){
      const cols = ['developer','project_coldwell','coldwell_raw','project_nawy','nawy_raw','project_red','red_raw','note'];
      const head = cols.join(',');
      const body = rows.map(r=> cols.map(c=>{
        const v = r[c]; if(v==null) return '';
        const s = typeof v==='number'? v : String(v).replaceAll('"','""');
        return /[,\n"]/.test(String(s))? '"'+s+'"' : s;
      }).join(',')).join('\n');
      return head+'\n'+body;
    }

    function apply(){
      const q = document.getElementById('search').value.trim().toLowerCase();
      const pick = document.getElementById('devList').value.trim().toLowerCase();
      const filtered = DATA.filter(r=>{
        const d=(r.developer||'').toLowerCase();
        if(pick && d!==pick) return false;
        if(q && !d.includes(q)) return false;
        return true;
      });
      render(filtered);
      document.getElementById('export').onclick = ()=>{
        const csv = toCSV(filtered);
        const blob = new Blob([csv], {type:'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download='commission_results.csv'; a.click();
        setTimeout(()=> URL.revokeObjectURL(url), 1000);
      };
    }

    const devList = document.getElementById('devList');
    [...new Set(DATA.map(r=>r.developer).filter(Boolean))].sort((a,b)=>a.localeCompare(b)).forEach(d=>{
      const opt=document.createElement('option'); opt.value=d; opt.textContent=d; devList.appendChild(opt);
    });

    document.getElementById('go').addEventListener('click', apply);
    document.getElementById('search').addEventListener('input', apply);
    devList.addEventListener('change', apply);

    render(DATA);
  </script>
</body>
</html>
